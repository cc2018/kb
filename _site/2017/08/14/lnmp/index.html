<!DOCTYPE html>
<html>

  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>lnmp - Just for recording</title>

	<link rel="shortcut icon" href="/static/images/favicon.jpg">
	<link rel="icon" href="/static/images/favicon.jpg">

	<link rel="stylesheet" href="/static/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/css/common.css">

	<link rel="canonical" href="/2017/08/14/lnmp/">
	<link rel="alternate" type="application/rss+xml" title="Just for recording" href="/feed.xml">

	<meta name="keywords" content="lnmp, Just for recording, personal blog;">
	<meta name="description" content="personal blog;">

	<script src="/static/js/jquery.min.js"></script>
	<!--[if lt IE 9]>
    	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  	<![endif]-->
  	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?ff1da0dd6c6a814ef6ec49dd10246092";
		  var s = document.getElementsByTagName("script")[0];
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
</head>


  <body class="index">

    <header class="navbar navbar-inverse navbar-fixed-top docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        <span>CC-2018</span>
      </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="/">Home</a>
        </li>
        <li>
          <a href="/categories/">Categories</a>
        </li>
        <li>
          <a href="/tag">Tag</a>
        </li>
      </ul>
    </nav>
  </div>
</header>

    <div class="docs-header" id="content">
  <div class="container">
      <div class="desc">
          
        		<!--
      		    <h1>lnmp</h1>
      		    <p>Post on Aug 14, 2017 by <a href="/about">CC-2018</a></p>
      		-->
      		    <h1>Some words wanna say</h1>
          
      </div>
  </div>
</div>

    
      
<div class="docs-banner">
  <div class="container">
      <div class="row">
          
          	<a href="/categories/#document-ref">document</a>	/
          	<a href="/tag/#教程-ref">教程</a>
          
      </div>

  </div>
</div>

    

    <div class="docs-container container">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar hidden-print" role="complementary">
        <div id="navigation">
  <h2>目录</h2>
  <ul class="nav sidenav">
<!--
    
      
      
      
      

      
        <li><a href="#year_2017">2017</a>
          <ul class="nav">
            <li><a href="#month_2017_August">August</a></li>
      

      
        
          
        
      
    
      
      
      
      

      

      
        
          
        
      
    
      
      
      
      

      

      
        
          
              <li><a href="#month_2017_July">July</a></li>
          
        
      
    
      
      
      
      

      

      
        
          
        
      
    
      
      
      
      

      

      
        
          
              <li><a href="#month_2017_June">June</a></li>
          
        
      
    
      
      
      
      

      

      
        
          
        
      
    
      
      
      
      

      

      
        
          
        
      
    
      
      
      
      

      

      
        
          
        
      
    
      
      
      
      

      

      
        
          
        
      
    
      
      
      
      

      

      
        
          
        
      
    
      
      
      
      

      

      
        
          
        
      
    
      
      
      
      

      

      
            </ul>
          </li>
      
    
-->
  </ul>
</div>

      </div>
    </div>
    <div class="col-md-9" role="main">
      <div class="panel docs-content">
        <div class="wrapper">
            <header class="post-header">
              <h1 class="post-title">lnmp</h1>
              <!--
                <p class="post-meta">Aug 14, 2017 • CC-2018</p>
              -->
              <div class="meta">Posted on <span class="postdate">Aug 14, 2017</span> By <a target="_blank" href="http://localhost:4000">CC-2018</a></div>
              <br />
            </header>
            <article class="post-content">
              <ul id="markdown-toc">
  <li><a href="#nginx安装" id="markdown-toc-nginx安装">nginx安装</a></li>
  <li><a href="#php安装" id="markdown-toc-php安装">php安装</a></li>
</ul>

<p>将lnmp都编译安装到用户路径下</p>

<h3 id="nginx安装">nginx安装</h3>

<p>下载源码：<a href="https://nginx.org/download/nginx-1.11.10.tar.gz">nginx源码</a></p>

<p>nginx编译依赖pcre，zlib，并且要指定源码路径（会从源码路径寻找makefile）</p>

<div class="highlighter-rouge"><pre class="highlight"><code>tar xzvf nginx-1.11.10.tar.gz
cd nginx-1.11.10
./configure --prefix=$HOME/local/nginx --with-pcre=$HOME/opt/pcre-8.38 --with-openssl=$HOME/local/openssl --with-zlib=$HOME/opt/zlib-1.2.11
make &amp;&amp; make install
</code></pre>
</div>

<p><strong>配置nginx</strong></p>

<p>使用include vhosts站点配置方式</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#user  nobody;
worker_processes  1;
error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;
pid        logs/nginx.pid;
events {
    worker_connections  1024;
}
# load modules compiled as Dynamic Shared Object (DSO)
#
#dso {
#    load ngx_http_fastcgi_module.so;
#    load ngx_http_rewrite_module.so;
#}
http {
    include       mime.types;
    default_type  application/octet-stream;
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';
    #access_log  logs/access.log  main;
    sendfile        on;
    #tcp_nopush     on;
    #keepalive_timeout  0;
    keepalive_timeout  65;
    #gzip  on;
    # server {
         #listen       80;
         #server_name  localhost;

         #charset koi8-r;

         #access_log  logs/host.access.log  main;

         #location / {
         #   root   html;
         #   index  index.html index.htm;
         #}

         #error_page  404              /404.html;

         # redirect server error pages to the static page /50x.html

         #error_page   500 502 503 504  /50x.html;
         #location = /50x.html {
         #    root   html;
         #}

         # proxy the PHP scripts to Apache listening on 127.0.0.1:80
         #
         #location ~ \.php$ {
         #    proxy_pass   http://127.0.0.1;
         #}

         # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
         #
         #location ~ \.php$ {
         #    root           html;
         #    fastcgi_pass   127.0.0.1:9000;
         #    fastcgi_index  index.php;
         #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
         #    include        fastcgi_params;
         #}

         # deny access to .htaccess files, if Apache's document root
         # concurs with nginx's one
         #
         #location ~ /\.ht {
         #    deny  all;
         #}
    #}

    # another virtual host using mix of IP-, name-, and port-based configuration
    #
    #server {
    #    listen       8000;
    #    listen       somename:8080;
    #    server_name  somename  alias  another.alias;
    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}

    # HTTPS server
    #
    #server {
    #    listen       443 ssl;
    #    server_name  localhost;
    #    ssl_certificate      cert.pem;
    #    ssl_certificate_key  cert.key;
    #    ssl_session_cache    shared:SSL:1m;
    #    ssl_session_timeout  5m;
    #    ssl_ciphers  HIGH:!aNULL:!MD5;
    #    ssl_prefer_server_ciphers  on;
    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}

    include vhosts/*.conf;
}
</code></pre>
</div>

<p>站点配置</p>
<div class="highlighter-rouge"><pre class="highlight"><code>server {
    listen  8089;
    server_name www.test.com localhost;

    charset  utf-8;
    access_log  /home/users/caojian02/web/logs/www.test.com/access.log;
    error_log  /home/users/caojian02/web/logs/www.test.com/error.log;

    root /home/users/caojian02/web/webroot/www.test.com/public;
    index index.php index.html index.htm;

    try_files $uri $uri/ @rewrite;    
    location @rewrite {    
        rewrite ^/(.*)$ /index.php?_url=/$1;    
    }      

    location ~ \.php$ {
	fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_split_path_info  ^(.+\.php)(/.+)$;
        fastcgi_param  SCRIPT_FILENAME  /home/users/caojian02/web/webroot/www.test.com/www$fastcgi_script_name;
        include        fastcgi_params;
    }

    location ~ /\.(ht|svn|git) {
        deny  all;
    }

    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ {
        expires  50d;
    }

    location ~ .*\.(js|css)?$ {
        expires  50d;
    }
}
</code></pre>
</div>

<p>启动nginx</p>
<div class="highlighter-rouge"><pre class="highlight"><code>$HOME/local/nginx/sbin/nginx -c $HOME/local/nginx/conf/nginx.conf

#配置重启
$HOME/local/nginx/sbin/nginx -s reload
</code></pre>
</div>

<h3 id="php安装">php安装</h3>

<p>下载源码：<a href="http://am1.php.net/get/php-7.1.2.tar.gz/from/this/mirror">php源码</a></p>

<p>有必要指定依赖路径，例如 –with-zlib, –with-openssl</p>

<div class="highlighter-rouge"><pre class="highlight"><code>tar xzvf php-7.1.2.tar.gz
cd php-7.1.2
./configure  --prefix=$HOME/local/php --with-pdo-mysql=mysqlnd --with-mysqli=mysqlnd --enable-mysqlnd --enable-mbstring --enable-mbregex --with-curl --enable-sockets --with-iconv --with-freetype-dir --with-png-dir --with-jpeg-dir --with-gd --with-zlib=$HOME/local/zlib --enable-xml --with-openssl=$HOME/local/openssl --enable-pcntl --enable-zip --with-bz2 --enable-soap --enable-exif --enable-ftp --enable-shmop --with-libxml-dir --with-mhash --with-xmlrpc --enable-wddx --with-curl --enable-fpm
</code></pre>
</div>

<p>编辑$HOME/local/php/etc/php-fpm.conf，打开配置</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pid = run/php-fpm.pid
error_log = log/php-fpm.log
</code></pre>
</div>

<p>编辑$HOME/local/php/etc/php-fpm.d/www.conf</p>

<div class="highlighter-rouge"><pre class="highlight"><code>listen.owner = xxx_user
listen.group = xxx_user
</code></pre>
</div>

<p>启动php-fpm:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>$HOME/local/php/sbin/php-fpm
</code></pre>
</div>

<p>再在<code class="highlighter-rouge">$HOME/web/webroot/www.test.com/html</code> 下新建index.php，内容编辑如下：</p>
<div class="highlighter-rouge"><pre class="highlight"><code>&lt;?php
    phpinfo();
?&gt;
</code></pre>
</div>
<p>就能看到正常的网页显示php信息了。</p>

            </article>
        </div>
      </div>
      <!-- <div class="panel docs-content">
        <article class="post-content">
          <div class="wrapper">
            <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
          </div>
        </article>
      </div> -->
    </div>
  </div>
</div>

    
    <footer class="footer" role="contentinfo">
	<div class="container">
		<p class="copyright">Copyright &copy; 2016-2017 CC-2018.</p>
	</div>
</footer>

<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/holder.min.js"></script>
<script src="/static/js/lessismore.js"></script>
<script src="/static/js/application.js"></script>


  </body>
</html>
